<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">

<span id='datadomain-PlayingStateRepository'>/**
</span> * PlayingStateRepository is the repository class for PlayingState model.
 */
datadomain.PlayingStateRepository = subclass(function (pt) {
    &#39;use strict&#39;;

    var PLAYING_DATA_KEY = &#39;playing-state-&#39;;


<span id='datadomain-PlayingStateRepository-method-getByCharIdLevelId'>    /**
</span>     * Gets a playing state by the character id.
     *
     * @param {String} chadId The character id
     * @param {String} levelId The level id
     * @return {Promise}
     */
    pt.getByCharIdLevelId = function (charId, levelId) {

        return infrastructure.storage.get(PLAYING_DATA_KEY + charId, null).then(function (data) {

            if (data == null) {
                return new datadomain.PlayingState(charId, levelId, [[]]);
            }

            if (data.levelId !== levelId) {
                return new datadomain.PlayingState(charId, levelId, [[]]);
            }

            return new datadomain.PlayingState(data.charId, data.levelId, data.rounds);

        });

    };


<span id='datadomain-PlayingStateRepository-method-save'>    /**
</span>     * Saves the playingState
     *
     * @return {Promise}
     */
    pt.save = function (playingState) {

        return infrastructure.storage.set(PLAYING_DATA_KEY + playingState.charId, this.toObject(playingState)).then(function () {

            return playingState;

        });

    };

<span id='datadomain-PlayingStateRepository-method-clearByCharId'>    /**
</span>     * Clears the data by the character id
     *
     * @param {String} id The character id
     * @return {Promise}
     */
    pt.clearByCharId = function (id) {

        return infrastructure.storage.set(PLAYING_DATA_KEY + id, null);

    };

<span id='datadomain-PlayingStateRepository-method-toObject'>    /**
</span>     * @private
     * Converts to the object
     *
     * @param {datadomain.PlayingState} playingState The playing state
     * @return {Object}
     */
    pt.toObject = function (playingState) {

        return {
            charId: playingState.charId,
            levelId: playingState.levelId,
            rounds: playingState.rounds
        };

    };

});
</pre>
</body>
</html>
