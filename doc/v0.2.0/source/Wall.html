<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">
<span id='domain-map-Wall'>/**
</span> * @class
 * Wall class handles the position of wall (scrolling of wall div (&#39;.floor-wrapper&#39;)) and objects on wall.
 */
domain.map.Wall = subclass(function (pt) {
    &#39;use strict&#39;;

<span id='domain-map-Wall-method-constructor'>    /**
</span>     * @constructor
     */
    pt.constructor = function () {
        this.wos = [];
        this.groundLevel = $(window).height() * (1 - domain.map.Floor.HEIGHT_RATE);
        this.wallWidth = $(window).width();
        this.$dom = $(&#39;.floor-wrapper&#39;);
    };

<span id='domain-map-Wall-method-loadFromObjectList'>    /**
</span>     * Loads floorObjects from the array of FloorObjects
     *
     * @param {Array} objects The array of floorObjects
     */
    pt.loadFromObjectList = function (objects) {
        var that = this;

        this.wos = objects.map(function (floorObject) {

            that.transformCoordinates(floorObject);

            return domain.map.WallObjectFactory.createFromObject(floorObject).setParent(that.$dom);

        });

        this.expandRightLimit(100);
    };

    pt.transformCoordinates = function (floorObject) {

        floorObject.offset.y *= -1;
        floorObject.offset.y += this.groundLevel;
        floorObject.offset.y -= floorObject.size.height;

    };

    pt.expandRightLimit = function (val) {
        var x = this.rightLimit() + val;

        $(&#39;&lt;div /&gt;&#39;)
            .appendTo(this.$dom)
            .css({width: &#39;1px&#39;, height: &#39;1px&#39;, &#39;position&#39;: &#39;absolute&#39;})
            .offset({left: x, top: this.groundLevel});
    };

    pt.rightLimit = function () {
        return Math.max.apply(Math, this.wos.map(function (wo) { return wo.rightLimit(); }));
    };

    pt.appear = function () {
        var that = this;

        var p = Promise.resolve();

        this.scrollSetToPosition(this.cls.chr.getPosition().floorObjectId);

        this.wos.forEach(function (wo) {
            p = p.then(function () {
                wo.appear();

                return wait(100);
            });
        });

        return p;
    };

    pt.disappear = function () {
        var p = Promise.resolve();

        this.wos.forEach(function (wo) {

            p = p.then(function () {
                wo.disappear();

                return wait(100);
            });

        });

        return p;
    };

    pt.scrollSetToPosition = function (id) {
        var wo = this.findById(id);

        if (wo == null) {
            console.error(&#39;wall object not found (id = &#39; + id + &#39;)&#39;);

            return;
        }

        return this.scrollSet(wo.centerX());
    };

    pt.scrollSet = function (x) {
        this.$dom.scrollLeft(x - this.wallWidth / 2);

        return this;
    };

    pt.scroll = function (x, dur) {
        this.$dom.animate({scrollLeft: this.$dom.scrollLeft() + x}, dur);

        return wait(dur);
    };

    pt.scrollTo = function (x, dur) {
        this.$dom.animate({scrollLeft: x - this.wallWidth / 2}, dur);

        return wait(dur);
    };

    pt.setCharLocateService = function (cls) {
        this.cls = cls;

        this.wos.forEach(function (wo) {
            wo.setCharLocateService(cls);
        });

        return this;
    };

<span id='domain-map-Wall-method-visible'>    /**
</span>     * Check if the character is visible on the wall.
     *
     * @param {domain.common.CharSprite} chr The character
     * @returns {Boolean}
     */
    pt.visible = function (chr) {
        return chr.rightLimit() &gt; this.$dom.scrollLeft() &amp;&amp; chr.leftLimit() &lt; this.$dom.scrollLeft() + this.wallWidth;
    };

<span id='domain-map-Wall-method-findById'>    /**
</span>     * Find the wall object of the given id.
     *
     * @param {String} id The id of the wall object
     * @returns {domain.map.Door}
     */
    pt.findById = function (id) {
        return this.wos.filter(function (wo) {
            return wo.id === id;
        })[0];
    };

});
</pre>
</body>
</html>
